{
	"info": {
		"_postman_id": "gangazon-auth-service-v1",
		"name": "Gangazon Auth Service API",
		"description": "Sistema de autenticación centralizada para aplicaciones corporativas de Gangazon. Esta API gestiona autenticación, usuarios, roles, franquicias, locales, asignaciones de empleados y control de asistencia (check-in/check-out).\n\n## Características principales\n- Autenticación JWT (Access Token + Refresh Token)\n- Gestión de usuarios y roles jerárquicos\n- Administración de franquicias y locales\n- Asignaciones de empleados a locales\n- Sistema de fichaje con validación GPS\n- Control de acceso basado en roles (RBAC)\n\n## Roles disponibles\n- **admin**: Administrador de casa matriz (acceso completo)\n- **franchisee**: Franquiciado (gestiona su franquicia)\n- **manager**: Gerente de local\n- **supervisor**: Supervisor de local\n- **employee**: Empleado\n- **viewer**: Solo lectura\n\n## Autenticación\nLa mayoría de los endpoints requieren un token de autenticación en el header:\n```\nAuthorization: Bearer <access_token>\n```\n\n## Variables de entorno requeridas\n- `{{base_url}}`: URL base del servidor (ej: http://localhost:3001)\n- `{{access_token}}`: Token de acceso JWT\n- `{{refresh_token}}`: Token de refresco\n- `{{emergency_token}}`: Token de emergencia (solo para endpoint de emergencia)",
		"version": "1.0.0",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": ["{{base_url}}"],
							"path": ["health"]
						},
						"description": "Verifica el estado del servicio y la conexión a la base de datos."
					},
					"response": []
				}
			],
			"description": "Endpoints para verificar el estado del servicio"
		},
		{
			"name": "Authentication",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.tokens) {",
									"        pm.environment.set('access_token', jsonData.data.tokens.accessToken);",
									"        pm.environment.set('refresh_token', jsonData.data.tokens.refreshToken);",
									"        console.log('Tokens guardados en variables de entorno');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@gangazon.com\",\n  \"password\": \"SecurePass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "login"]
						},
						"description": "Autentica un usuario y devuelve tokens de acceso y refresco."
					},
					"response": []
				},
				{
					"name": "Register (Admin Only)",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"nuevo.usuario@gangazon.com\",\n  \"password\": \"SecurePass123!\",\n  \"firstName\": \"Nuevo\",\n  \"lastName\": \"Usuario\",\n  \"role\": \"employee\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "register"]
						},
						"description": "Registra un nuevo usuario (solo administradores). Para crear usuarios normales use POST /api/users."
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.tokens) {",
									"        pm.environment.set('access_token', jsonData.data.tokens.accessToken);",
									"        console.log('Access token actualizado');",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/refresh",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "refresh"]
						},
						"description": "Renueva el access token usando un refresh token válido."
					},
					"response": []
				},
				{
					"name": "Logout",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/logout",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "logout"]
						},
						"description": "Cierra sesión e invalida el refresh token."
					},
					"response": []
				},
				{
					"name": "Change Password",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"currentPassword\": \"OldPass123!\",\n  \"newPassword\": \"NewSecurePass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/change-password",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "change-password"]
						},
						"description": "Cambia la contraseña del usuario autenticado."
					},
					"response": []
				},
				{
					"name": "Verify Token",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/verify",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "verify"]
						},
						"description": "Verifica si un token es válido (útil para validación desde otras aplicaciones)."
					},
					"response": []
				},
				{
					"name": "Get Profile",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/profile",
							"host": ["{{base_url}}"],
							"path": ["api", "auth", "profile"]
						},
						"description": "Obtiene el perfil completo del usuario autenticado."
					},
					"response": []
				}
			],
			"description": "Endpoints de autenticación y gestión de sesión"
		},
		{
			"name": "Users",
			"item": [
				{
					"name": "Create User",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"empleado@gangazon.com\",\n  \"password\": \"SecurePass123!\",\n  \"firstName\": \"Juan\",\n  \"lastName\": \"Pérez\",\n  \"role\": \"employee\",\n  \"franchiseId\": \"uuid-de-franquicia\",\n  \"locationId\": \"uuid-de-local\",\n  \"phone\": \"+34600123456\",\n  \"startDate\": \"2024-01-15\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users",
							"host": ["{{base_url}}"],
							"path": ["api", "users"]
						},
						"description": "Crea un nuevo usuario en el sistema. Requiere rol admin o franchisee. Si se proporciona locationId, se crea automáticamente una asignación."
					},
					"response": []
				},
				{
					"name": "List Users",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/users?page=1&limit=50&search=&role=",
							"host": ["{{base_url}}"],
							"path": ["api", "users"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "search",
									"value": ""
								},
								{
									"key": "role",
									"value": ""
								}
							]
						},
						"description": "Lista usuarios del sistema (solo admins). Soporta paginación, búsqueda y filtro por rol."
					},
					"response": []
				},
				{
					"name": "Get User by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/users/:userId",
							"host": ["{{base_url}}"],
							"path": ["api", "users", ":userId"],
							"variable": [
								{
									"key": "userId",
									"value": ""
								}
							]
						},
						"description": "Obtiene información detallada de un usuario específico."
					},
					"response": []
				},
				{
					"name": "Get Current User (Me)",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/users/me",
							"host": ["{{base_url}}"],
							"path": ["api", "users", "me"]
						},
						"description": "Obtiene el perfil del usuario autenticado."
					},
					"response": []
				},
				{
					"name": "Update Current User",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Juan Carlos\",\n  \"lastName\": \"Pérez García\",\n  \"email\": \"nuevo.email@gangazon.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/me",
							"host": ["{{base_url}}"],
							"path": ["api", "users", "me"]
						},
						"description": "Actualiza el perfil del usuario autenticado."
					},
					"response": []
				},
				{
					"name": "Update User",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Juan Carlos\",\n  \"lastName\": \"Pérez García\",\n  \"email\": \"nuevo.email@gangazon.com\",\n  \"role\": \"manager\",\n  \"isActive\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/:userId",
							"host": ["{{base_url}}"],
							"path": ["api", "users", ":userId"],
							"variable": [
								{
									"key": "userId",
									"value": ""
								}
							]
						},
						"description": "Actualiza un usuario específico (solo admins)."
					},
					"response": []
				},
				{
					"name": "Deactivate User",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/users/:userId",
							"host": ["{{base_url}}"],
							"path": ["api", "users", ":userId"],
							"variable": [
								{
									"key": "userId",
									"value": ""
								}
							]
						},
						"description": "Desactiva un usuario (no se elimina, solo se marca como inactivo)."
					},
					"response": []
				}
			],
			"description": "Gestión de usuarios del sistema"
		},
		{
			"name": "Roles",
			"item": [
				{
					"name": "List Roles",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/roles",
							"host": ["{{base_url}}"],
							"path": ["api", "roles"]
						},
						"description": "Lista todos los roles disponibles según el usuario autenticado."
					},
					"response": []
				},
				{
					"name": "Get Role Info",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/roles/:roleName",
							"host": ["{{base_url}}"],
							"path": ["api", "roles", ":roleName"],
							"variable": [
								{
									"key": "roleName",
									"value": "admin"
								}
							]
						},
						"description": "Obtiene información detallada de un rol específico."
					},
					"response": []
				},
				{
					"name": "Get Role Permissions",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/roles/:roleName/permissions",
							"host": ["{{base_url}}"],
							"path": ["api", "roles", ":roleName", "permissions"],
							"variable": [
								{
									"key": "roleName",
									"value": "manager"
								}
							]
						},
						"description": "Obtiene los permisos detallados de un rol específico."
					},
					"response": []
				},
				{
					"name": "Check Permission",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"resource\": \"users\",\n  \"action\": \"update\",\n  \"targetUserId\": \"uuid-del-usuario\",\n  \"targetOrganizationId\": \"uuid-de-organizacion\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/roles/check-permission",
							"host": ["{{base_url}}"],
							"path": ["api", "roles", "check-permission"]
						},
						"description": "Verifica si el usuario tiene un permiso específico."
					},
					"response": []
				},
				{
					"name": "Get Users by Role",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/roles/:roleName/users?organizationId=",
							"host": ["{{base_url}}"],
							"path": ["api", "roles", ":roleName", "users"],
							"query": [
								{
									"key": "organizationId",
									"value": ""
								}
							],
							"variable": [
								{
									"key": "roleName",
									"value": "employee"
								}
							]
						},
						"description": "Lista usuarios con un rol específico."
					},
					"response": []
				}
			],
			"description": "Gestión de roles y permisos del sistema"
		},
		{
			"name": "Franchises",
			"item": [
				{
					"name": "Create Franchise",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Gangazon Madrid Centro\",\n  \"franchiseeName\": \"María García López\",\n  \"franchiseeEmail\": \"maria.garcia@gangazon.com\",\n  \"franchiseePhone\": \"+34600111222\",\n  \"contractStartDate\": \"2024-01-01\",\n  \"contractEndDate\": \"2026-12-31\",\n  \"maxLocations\": 5,\n  \"maxEmployees\": 25,\n  \"billingTier\": \"premium\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/franchises",
							"host": ["{{base_url}}"],
							"path": ["api", "franchises"]
						},
						"description": "Crea una nueva franquicia (solo casa matriz/admin)."
					},
					"response": []
				},
				{
					"name": "List Franchises",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/franchises?page=1&limit=50&search=&status=",
							"host": ["{{base_url}}"],
							"path": ["api", "franchises"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "search",
									"value": ""
								},
								{
									"key": "status",
									"value": "",
									"description": "active, suspended, terminated"
								}
							]
						},
						"description": "Lista franquicias con paginación y filtros."
					},
					"response": []
				},
				{
					"name": "Get Franchise by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/franchises/:franchiseId",
							"host": ["{{base_url}}"],
							"path": ["api", "franchises", ":franchiseId"],
							"variable": [
								{
									"key": "franchiseId",
									"value": ""
								}
							]
						},
						"description": "Obtiene información detallada de una franquicia incluyendo estadísticas."
					},
					"response": []
				},
				{
					"name": "Update Franchise",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Gangazon Madrid Centro Norte\",\n  \"franchiseePhone\": \"+34600999888\",\n  \"maxLocations\": 7,\n  \"maxEmployees\": 35,\n  \"billingTier\": \"enterprise\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/franchises/:franchiseId",
							"host": ["{{base_url}}"],
							"path": ["api", "franchises", ":franchiseId"],
							"variable": [
								{
									"key": "franchiseId",
									"value": ""
								}
							]
						},
						"description": "Actualiza información de una franquicia."
					},
					"response": []
				},
				{
					"name": "Change Franchise Status",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"status\": \"suspended\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/franchises/:franchiseId/status",
							"host": ["{{base_url}}"],
							"path": ["api", "franchises", ":franchiseId", "status"],
							"variable": [
								{
									"key": "franchiseId",
									"value": ""
								}
							]
						},
						"description": "Cambia el estado de una franquicia (active, suspended, terminated)."
					},
					"response": []
				}
			],
			"description": "Gestión de franquicias"
		},
		{
			"name": "Locations",
			"item": [
				{
					"name": "Create Location",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"franchiseId\": \"uuid-de-franquicia\",\n  \"name\": \"Local Centro Comercial Plaza Norte\",\n  \"address\": \"Calle Gran Vía, 123, Local 5\",\n  \"city\": \"Madrid\",\n  \"postalCode\": \"28013\",\n  \"country\": \"España\",\n  \"phone\": \"+34911222333\",\n  \"email\": \"local.plazanorte@gangazon.com\",\n  \"managerId\": \"uuid-del-manager\",\n  \"maxEmployees\": 8,\n  \"operatingHours\": {\n    \"monday\": {\"open\": \"09:00\", \"close\": \"21:00\"},\n    \"tuesday\": {\"open\": \"09:00\", \"close\": \"21:00\"},\n    \"wednesday\": {\"open\": \"09:00\", \"close\": \"21:00\"},\n    \"thursday\": {\"open\": \"09:00\", \"close\": \"21:00\"},\n    \"friday\": {\"open\": \"09:00\", \"close\": \"21:00\"},\n    \"saturday\": {\"open\": \"10:00\", \"close\": \"22:00\"},\n    \"sunday\": {\"open\": \"11:00\", \"close\": \"20:00\"}\n  },\n  \"timezone\": \"Europe/Madrid\",\n  \"coordinates\": {\n    \"lat\": 40.4168,\n    \"lng\": -3.7038\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/locations",
							"host": ["{{base_url}}"],
							"path": ["api", "locations"]
						},
						"description": "Crea un nuevo local dentro de una franquicia."
					},
					"response": []
				},
				{
					"name": "List Locations",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/locations?page=1&limit=50&search=&franchiseId=&city=",
							"host": ["{{base_url}}"],
							"path": ["api", "locations"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "search",
									"value": ""
								},
								{
									"key": "franchiseId",
									"value": ""
								},
								{
									"key": "city",
									"value": ""
								}
							]
						},
						"description": "Lista locales según permisos del usuario."
					},
					"response": []
				},
				{
					"name": "Get Location by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/locations/:locationId",
							"host": ["{{base_url}}"],
							"path": ["api", "locations", ":locationId"],
							"variable": [
								{
									"key": "locationId",
									"value": ""
								}
							]
						},
						"description": "Obtiene información detallada de un local incluyendo estadísticas."
					},
					"response": []
				},
				{
					"name": "Get Location Employees",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/locations/:locationId/employees",
							"host": ["{{base_url}}"],
							"path": ["api", "locations", ":locationId", "employees"],
							"variable": [
								{
									"key": "locationId",
									"value": ""
								}
							]
						},
						"description": "Lista empleados activos asignados a un local."
					},
					"response": []
				},
				{
					"name": "Update Location",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Local Centro Comercial Plaza Norte (Ampliado)\",\n  \"phone\": \"+34911222444\",\n  \"maxEmployees\": 12,\n  \"managerId\": \"uuid-nuevo-manager\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/locations/:locationId",
							"host": ["{{base_url}}"],
							"path": ["api", "locations", ":locationId"],
							"variable": [
								{
									"key": "locationId",
									"value": ""
								}
							]
						},
						"description": "Actualiza información de un local."
					},
					"response": []
				},
				{
					"name": "Deactivate Location",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/locations/:locationId",
							"host": ["{{base_url}}"],
							"path": ["api", "locations", ":locationId"],
							"variable": [
								{
									"key": "locationId",
									"value": ""
								}
							]
						},
						"description": "Desactiva un local y todas sus asignaciones de empleados."
					},
					"response": []
				}
			],
			"description": "Gestión de locales comerciales"
		},
		{
			"name": "Assignments",
			"item": [
				{
					"name": "Create Assignment",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"user_id\": \"uuid-del-empleado\",\n  \"location_id\": \"uuid-del-local\",\n  \"role_at_location\": \"employee\",\n  \"start_date\": \"2024-01-15\",\n  \"end_date\": null,\n  \"shift_type\": \"full_time\",\n  \"notes\": \"Asignación principal del empleado\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/assignments",
							"host": ["{{base_url}}"],
							"path": ["api", "assignments"]
						},
						"description": "Asigna un empleado a un local con un rol específico."
					},
					"response": []
				},
				{
					"name": "List Assignments",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/assignments?page=1&limit=50&userId=&locationId=&franchiseId=&isActive=",
							"host": ["{{base_url}}"],
							"path": ["api", "assignments"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "userId",
									"value": ""
								},
								{
									"key": "locationId",
									"value": ""
								},
								{
									"key": "franchiseId",
									"value": ""
								},
								{
									"key": "isActive",
									"value": "",
									"description": "true o false"
								}
							]
						},
						"description": "Lista asignaciones de empleados con filtros."
					},
					"response": []
				},
				{
					"name": "Get Assignment by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/assignments/:assignmentId",
							"host": ["{{base_url}}"],
							"path": ["api", "assignments", ":assignmentId"],
							"variable": [
								{
									"key": "assignmentId",
									"value": ""
								}
							]
						},
						"description": "Obtiene detalles de una asignación específica."
					},
					"response": []
				},
				{
					"name": "Get User Active Assignments",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/assignments/user/:userId/active",
							"host": ["{{base_url}}"],
							"path": ["api", "assignments", "user", ":userId", "active"],
							"variable": [
								{
									"key": "userId",
									"value": ""
								}
							]
						},
						"description": "Lista asignaciones activas de un usuario específico."
					},
					"response": []
				},
				{
					"name": "Update Assignment",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"role_at_location\": \"supervisor\",\n  \"shift_type\": \"part_time\",\n  \"end_date\": \"2024-12-31\",\n  \"notes\": \"Promoción a supervisor\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/assignments/:assignmentId",
							"host": ["{{base_url}}"],
							"path": ["api", "assignments", ":assignmentId"],
							"variable": [
								{
									"key": "assignmentId",
									"value": ""
								}
							]
						},
						"description": "Actualiza una asignación existente."
					},
					"response": []
				},
				{
					"name": "End Assignment",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/assignments/:assignmentId",
							"host": ["{{base_url}}"],
							"path": ["api", "assignments", ":assignmentId"],
							"variable": [
								{
									"key": "assignmentId",
									"value": ""
								}
							]
						},
						"description": "Finaliza una asignación (la marca como inactiva)."
					},
					"response": []
				}
			],
			"description": "Gestión de asignaciones de empleados a locales"
		},
		{
			"name": "Check-ins",
			"item": [
				{
					"name": "Check-in",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"locationId\": \"uuid-del-local\",\n  \"checkInMethod\": \"gps\",\n  \"coordinates\": {\n    \"lat\": 40.4168,\n    \"lng\": -3.7038\n  },\n  \"notes\": \"Check-in normal\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/checkins/checkin",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins", "checkin"]
						},
						"description": "Registra la entrada de un empleado a su local de trabajo. Valida GPS si se proporciona."
					},
					"response": []
				},
				{
					"name": "Check-out",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"checkinId\": \"uuid-del-checkin\",\n  \"breakDuration\": 30,\n  \"notes\": \"Fin de turno normal\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/checkins/checkout",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins", "checkout"]
						},
						"description": "Registra la salida de un empleado. Si no se proporciona checkinId, usa el check-in activo."
					},
					"response": []
				},
				{
					"name": "Get Current Status",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/checkins/status",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins", "status"]
						},
						"description": "Obtiene el estado actual del empleado (si tiene un check-in activo)."
					},
					"response": []
				},
				{
					"name": "List Check-ins",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/checkins?page=1&limit=50&userId=&locationId=&date=",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "50"
								},
								{
									"key": "userId",
									"value": ""
								},
								{
									"key": "locationId",
									"value": ""
								},
								{
									"key": "date",
									"value": "",
									"description": "YYYY-MM-DD"
								}
							]
						},
						"description": "Lista registros de check-in/check-out con historial."
					},
					"response": []
				},
				{
					"name": "Get Check-in by ID",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/checkins/:checkinId",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins", ":checkinId"],
							"variable": [
								{
									"key": "checkinId",
									"value": ""
								}
							]
						},
						"description": "Obtiene detalles de un registro de check-in específico."
					},
					"response": []
				},
				{
					"name": "Modify Check-in (Manager)",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"checkInTime\": \"2024-01-15T09:00:00Z\",\n  \"checkOutTime\": \"2024-01-15T18:00:00Z\",\n  \"breakDuration\": 30,\n  \"notes\": \"Ajuste aprobado por gerente\",\n  \"verifiedBy\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/checkins/:checkinId",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins", ":checkinId"],
							"variable": [
								{
									"key": "checkinId",
									"value": ""
								}
							]
						},
						"description": "Permite a managers/admins modificar registros de check-in (correcciones)."
					},
					"response": []
				},
				{
					"name": "Get Active Employees at Location",
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{access_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/checkins/location/:locationId/active",
							"host": ["{{base_url}}"],
							"path": ["api", "checkins", "location", ":locationId", "active"],
							"variable": [
								{
									"key": "locationId",
									"value": ""
								}
							]
						},
						"description": "Lista empleados que actualmente están en el local (con check-in activo)."
					},
					"response": []
				}
			],
			"description": "Sistema de fichaje (check-in/check-out) de empleados"
		},
		{
			"name": "Emergency",
			"item": [
				{
					"name": "Create Emergency Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const jsonData = pm.response.json();",
									"    if (jsonData.tokens) {",
									"        pm.environment.set('access_token', jsonData.tokens.accessToken);",
									"        pm.environment.set('refresh_token', jsonData.tokens.refreshToken);",
									"        console.log('Tokens de emergencia guardados automáticamente');",
									"    }",
									"    if (jsonData.user) {",
									"        pm.environment.set('userId', jsonData.user.id);",
									"        console.log('User ID guardado:', jsonData.user.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-emergency-token",
								"value": "{{emergency_token}}",
								"description": "Token de emergencia configurado en variables de entorno"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin.emergency@gangazon.com\",\n  \"password\": \"EmergencyPass123!\",\n  \"firstName\": \"Admin\",\n  \"lastName\": \"Emergency\",\n  \"role\": \"admin\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/emergency/create-admin",
							"host": ["{{base_url}}"],
							"path": ["api", "emergency", "create-admin"]
						},
						"description": "⚠️ ENDPOINT DE EMERGENCIA ⚠️\n\nCrea un usuario administrador sin autenticación previa y devuelve tokens JWT para login automático.\n\n**Requisitos:**\n1. Variable de entorno `ENABLE_EMERGENCY_ENDPOINT=true`\n2. Variable de entorno `EMERGENCY_ADMIN_TOKEN` configurada\n3. Header `x-emergency-token` con el token correcto\n\n**IMPORTANTE:** Desactive este endpoint en producción cambiando `ENABLE_EMERGENCY_ENDPOINT=false`\n\n**Roles permitidos:** admin, franchisee\n\n**Respuesta incluye:**\n- Usuario creado\n- Access Token (automáticamente guardado)\n- Refresh Token (automáticamente guardado)"
					},
					"response": []
				},
				{
					"name": "Check Emergency Status",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/emergency/status",
							"host": ["{{base_url}}"],
							"path": ["api", "emergency", "status"]
						},
						"description": "Verifica si el endpoint de emergencia está habilitado y configurado correctamente."
					},
					"response": []
				}
			],
			"description": "⚠️ Endpoints de emergencia (solo para recuperación de acceso)"
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{access_token}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3001",
			"type": "string"
		},
		{
			"key": "access_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "refresh_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "emergency_token",
			"value": "",
			"type": "string"
		}
	]
}
